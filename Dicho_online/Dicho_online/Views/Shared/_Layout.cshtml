<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <style>
    </style>
    @using System.Web.Optimization
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <!--navbar-->
    <nav class="navbar navbar-toggleable-md navbar-expand-md fixed-top navbar-dark" style="background-color:limegreen;">
        <a class="navbar-brand" href="#">Logo</a>
        <button class="navbar-toggler navbar-toggler-right collapsed active" type="button" data-toggle="collapse" data-target="#navb" aria-expanded="false">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navb" style="">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="@Url.Action("Index","Home")"><b>Home</b></a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#"><b>Meat/Fish</b></a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#"><b>Vegetable</b></a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#"><b>Drinks</b></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#"><b>Meal Ready (coming soon)</b></a>
                </li>
            </ul>
            <form class="form-inline mr-md-auto search">
                <input id="search-text" class="form-control" type="text" autocomplete="off" placeholder="Search" style="display:inline">
                <button class="btn" type="button" style="display:inline">
                    <i class="fas fa-search"></i>
                </button>
                <div id="result"></div>
            </form>
            <div class="user">
                <a href="@Url.Action("ShowCart","Cart")">Cart&ensp;</a><span class="badge badge-danger numofitem"></span><span>&ensp;&ensp;&ensp;&ensp;</span>
                @if (Session["username"] != null)
                {
                    <a href="#" onclick="">@Session["username"]</a>
                    <span>&ensp;</span>                 
                    <a href="#" onclick="location.href='@Url.Action("LogOut", "Login")'">Logout</a>
                }
                else
                {
                    <a href="#" onclick="location.href='@Url.Action("Index", "Login")'">Login</a>
                }
            </div>
        </div>
        <style>
            .user > a{
                display: inline-block;
            }
            #result{
                background-color: white;
                border: 1px solid gray;
                width: 400px;
                min-height: 80px;
                max-height: 200px;
                overflow: auto;
                position:absolute;
                visibility: hidden;
                top: 38px;
                padding: 10px;                
            }
            @@media screen and (min-width: 992px){
                .navbar {
                    padding: 0;
                    padding-left: 20px;
                }

                .navbar-brand {
                    padding-top: 7px;
                    padding-bottom: 7px;
                }

                .navbar-collapse {
                    padding-bottom: 7px;
                    padding-top: 7px;
                }

                .search {
                    position: relative;
                    left: 10%;
                }

                #search-text {
                    width: 400px;
                }
            }

            @@media only screen and (min-width: 400px) and (max-width: 768px) {
                .nav-link {
                    border-bottom: 1px solid white;
                }

                .navbar-collapse {
                    border-top: 2px solid white;
                    margin-top: 10px;
                }

                .navbar {
                    border-bottom: 2px solid black;
                    width: 100%;
                }

                .search {
                    padding-top: 30px;
                }

                #search-text {
                    width: 85%;
                }

                .user{
                    padding-top: 20px;
                }
            }

            @@media only screen and (min-width: 769px) and (max-width: 991px) {
                .search {
                    position: relative;
                    left: 15%;
                }
            }

            .form-control {
                border-radius: 0;
            }

            .btn {
                border-radius: 0;
            }

            .user {
                padding-right: 30px;
                float: right;
            }

            .nav-link {
                opacity: unset;
            }
            .body{
                min-height:441px;
            }

        </style>
        <script>

        </script>
    </nav>
    <div class="container-fluid body" style="padding-top:60px">
        @RenderBody()
        <hr />
    </div>

    <footer class="footer-navbar">
        <div class="row no-gutters">
            <div class="col-sm-3">
                <hr />
                <div class="footer-list">
                    <div class="list-header">Customer Service</div>
                    <a href="#">FAQ</a><br />
                    <a href="#">Track Order</a><br />
                    <a href="#">Sitemap</a><br />
                    <a href="#">Feedback</a><br />
                </div>
            </div>
            <div class="col-sm-3">
                <hr />
                <div class="footer-list">
                    <div class="list-header">Rules and Policy</div>
                    <a href="#">Privacy Policy</a><br />
                    <a href="#">Payment Method</a><br />
                    <a href="#">Terms of Service</a><br />
                </div>
            </div>
            <div class="col-sm-6">
                <hr />
                <div class="footer-list">
                    <div class="list-header">Contact</div>
                    Address: #<br />
                    Telephone: (024)<br />
                    Fax: #<br />
                    Email: #<br />
                    Open hours: #
                </div>
            </div>
        </div>

        <style>
            .list-header {
                font-size: 15px;
                font-weight: bold;
                text-decoration: underline;
            }

            .footer-navbar {
                background-color: limegreen;
                color: white;
            }

            a {
                color: white;
            }

            .footer-list {
                padding-left: 50px;
                padding-bottom: 30px;
            }

            .result{
                padding: 0;
                margin:0;
                width: 100%;
            }
            .result td{
                width: 50%;
            }
            .result-link{
                color:black;
            }
        </style>
    </footer>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">

    <script>
        $(document).ready(function () {
            $("#result").slideUp(0);
            $.ajax({
                url: '/Cart/numberOfItemsInCart',
                type: 'post',
                dataType: 'json',
                data: {},
                success: function (data) {
                    $(".numofitem").html(data);
                }
            });

            $("#search-text").keyup(function(){
                $("#result").css("visibility","visible");
                $("#result").slideDown();
                var string = $("#search-text").val();
                if(string != ""){
                    $("#result").html("<i>No result...</i>");
                    $.ajax({
                        url: '/Products/Search',
                        type: 'post',
                        dataType: 'json',
                        data: {search: string},
                        success: function(data){                            
                            if(data!==null){
                                var obj = JSON.parse(data);
                                var i =0;
                                $("#result").html("");
                                for (i; i < obj.length; i++) {
                                    var unit = "";
                                    if (obj[i].container != "none") {
                                        unit = obj[i].container;
                                    }
                                    else {
                                        unit = obj[i].unitNetWeight + obj[i].measure;
                                    }
                                    $("#result").append(
                                        
                                        "<table class='result'>"+
                                        "<tr>"+
                                        "<td rowspan='2'>" + "<a class='result-link' href='" + "ProductDetails/Details/" + obj[i].id + "'>" + "<img src='" + obj[i].image + "' width='60px'>"+"</a>" +
                                        "</td>"+
                                        "<td>"+"<a class='result-link' href='"+ "ProductDetails/Details/"+obj[i].id+"'>"+obj[i].name+"</a>"+
                                        "</td>" +
                                        "<td rowspan='2'>" +
                                        "</td>" +
                                        "</tr>"+
                                        "<tr>"+
                                        "<td>"+"$ "+obj[i].price.toFixed(2)+" / "+unit+
                                        "</td>"+
                                        "</tr>"+
                                        "</table>"+
                                        "<hr>"
                                        );
                                }                               
                            }
                        }
                    });
                }
                else{
                    $("#result").html("<i>No result...</i>");
                }
            });
            $("#search-text").focusout(function(){
                $("#result").css("visibility","hidden");
            });
        });
    </script>

</body>
</html>
